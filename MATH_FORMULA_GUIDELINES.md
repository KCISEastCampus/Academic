# 数学公式使用指南

## 基本原则

### 1. 行内公式使用 `$...$`
**适用场景：**
- 简单变量和常数：$x$, $y$, $\pi$, $e$
- 简单运算符：$+$, $-$, $=$, $\neq$
- 简单函数：$f(x)$, $\sin x$, $\cos x$
- 简单指数：$x^2$, $e^x$
- **单层简单分数**：$\frac{1}{2}$, $\frac{x}{y}$
- 区间和不等式：$x > 0$, $[0, 1]$

**示例：**
```markdown
当 $x = 3$ 时，函数值为 $f(3) = 9$
斜率为 $m = \frac{1}{2}$
在区间 $x \in [0, \pi]$ 内
```

### 2. 显示公式使用 `$$...$$`
**适用场景：**
- **所有复杂分数**（分子分母包含多项式、三角函数等）
- 重要的定义和公式
- 积分、求和、极限等复杂表达式
- 多层分式和嵌套结构
- 长的计算过程
- 矩阵和行列式
- 分段函数

**示例：**
```markdown
$$\frac{x^2 + 2x + 1}{x^2 - 4x + 3}$$

$$\int_0^\infty e^{-x^2} dx = \frac{\sqrt{\pi}}{2}$$

$$\lvert x \rvert = \begin{cases} x & \text{if } x \geq 0 \\ -x & \text{if } x < 0 \end{cases}$$
```

## 🔑 关键判断标准：分数复杂度

### ✅ 行内分数 `$\frac{...}{...}$`
- 分子分母都是**单个字母或数字**
- 分子分母都是**简单一次项**
- 常见常数分数

```markdown
$\frac{1}{2}$, $\frac{x}{y}$, $\frac{a}{b}$, $\frac{\pi}{4}$
```

### ✅ 显示分数 `$$\frac{...}{...}$$`
- 分子或分母包含**多项式**
- 分子或分母包含**函数调用**
- 分子或分母包含**运算符**
- **嵌套分数**
- **长分数**

```markdown
$$\frac{x^2 + 2x + 1}{x - 3}$$
$$\frac{\sin x + \cos x}{x^2 - 1}$$
$$\frac{ax + b}{cx^2 + dx + e}$$
$$\frac{1}{1 + \frac{1}{x}}$$
```

## 具体修复案例

### 修复前后对比

#### 案例1：基本函数定义
❌ **错误：**
```markdown
- Linear/Linear: $$y = \frac{ax + b}{cx + d}$$
```

✅ **正确：**
```markdown
- Linear/Linear: $y = \frac{ax + b}{cx + d}$
```

#### 案例2：复杂计算过程
❌ **错误：**
```markdown
**Example 1:** $$\int xe^{2x} dx$$
- $$\int xe^{2x} dx = \frac{1}{2}xe^{2x} - \frac{1}{4}e^{2x} + c$$
```

✅ **正确：**
```markdown
**Example 1:** $\int xe^{2x} dx$

$$\int xe^{2x} dx = \frac{1}{2}xe^{2x} - \frac{1}{4}e^{2x} + c$$
```

#### 案例3：表格中的公式
❌ **错误：**
```markdown
| Product | $\(\frac{d}{dx}[uv] = u'v + uv'\)$ | Two functions multiplied |
```

✅ **正确：**
```markdown
| Product | $\frac{d}{dx}[uv] = u'v + uv'$ | Two functions multiplied |
```

## 已修复的问题

### 1. MathJax配置优化
- 修复了配置脚本的加载顺序
- 添加了 `displayMath` 配置
- 添加了 `mhchem` 包支持化学公式

### 2. 公式使用一致性
- 将列表项中的公式定义改为行内模式
- 将复杂计算步骤改为显示模式
- 修复了表格中的公式语法错误

### 3. 语法错误修复
- 移除了错误的 `$\(...\)$` 语法
- 统一使用 `$...$` 和 `$$...$$`

## 推荐的使用模式

### 文本中的变量引用
```markdown
当 $x > 0$ 时，函数 $f(x) = x^2$ 是递增的。
```

### 公式定义
```markdown
**抛物线标准方程：**
$$y^2 = 4ax$$
```

### 计算步骤
```markdown
求解过程：
$$\begin{align}
x^2 + 2x - 3 &= 0 \\
(x + 3)(x - 1) &= 0 \\
x &= -3 \text{ 或 } x = 1
\end{align}$$
```

### 几何形状参数
```markdown
**椭圆：** $\frac{x^2}{a^2} + \frac{y^2}{b^2} = 1$
- 长轴长度：$2a$
- 短轴长度：$2b$
- 焦点：$(±c, 0)$ 其中 $c^2 = a^2 - b^2$
```

## 最终决策规则 🎯

### 快速判断方法：
1. **看分数复杂度**：如果分子或分母超过单个字符，用 `$$...$$`
2. **看公式长度**：如果公式超过3-4个符号，考虑用 `$$...$$`
3. **看重要程度**：定义、定理等重要公式用 `$$...$$`
4. **看上下文**：如果影响阅读流畅性，用 `$$...$$`

### 特殊情况处理：

#### 表格中的公式：
- 简单公式：$(uv)' = u'v + uv'$
- 复杂公式：用 `\left(\right)` 增加可读性
- 避免嵌套分数，可以用文字描述

#### 长计算过程：
分步骤显示，每步一行：
```markdown
$$\text{步骤1} = \text{结果1}$$
$$= \text{步骤2}$$  
$$= \text{最终结果}$$
```

## 注意事项

1. **分数优先原则**：复杂分数必须用显示模式 `$$...$$`
2. **保持一致性**：同类型公式使用相同模式
3. **考虑阅读体验**：行内公式不应影响行间距
4. **表格优化**：表格中避免过于复杂的公式
5. **化学公式**：使用 `\ce{...}` 命令，如 `$\ce{H2SO4}$`

## 验证方法
创建了测试页面 `formula_test.md` 来验证公式显示效果，可以直接预览对比不同模式的显示效果。