<meta charset="UTF-8">
<!-- Immediately apply saved theme to avoid flash: reads localStorage before paint -->
<script>try{(function(){var t=localStorage.getItem('site-theme');if(t)document.documentElement.setAttribute('data-bs-theme',t);} )();}catch(e){/* ignore */}</script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>{{ page.title | default: site.title | escape }}</title>
<meta name="description" content="{{ page.description | default: site.description | escape }}">
<meta name="theme-color" content="#0b1220">

<!-- Resource hints for performance -->
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<link rel="preconnect" href="https://unpkg.com" crossorigin>

<!-- Bootstrap (CDN) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<!-- Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<!-- Editor & highlighting themes -->
<link href="/assets/css/gruvbox_dark_rouge.css" rel="stylesheet" media="(prefers-color-scheme: dark)">

<!-- Fonts -->
<link href="/assets/css/fonts/maplemono.css" rel="stylesheet">

<!-- MathJax: Universal Markdown Math & Chemistry Support -->
<script>
  window.mermaidConfig = { startOnLoad: false, theme: 'dark' };
  
  // MathJax 通用配置 - 支持标准Markdown数学和化学公式
  window.MathJax = {
    tex: {
      // 标准Markdown数学分隔符
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true,
      // 核心包：基础数学 + AMS扩展 + 化学公式
      packages: {'[+]': ['base', 'ams', 'newcommand', 'mhchem']},
      // 常用三角函数别名，避免数学教材写法导致报错
      macros: {
        cosec: '\\csc'
      }
    },
    // 使用CHTML输出，优化字体渲染和响应式
    chtml: {
      scale: 1.05,
      displayAlign: 'center',
      displayIndent: '0',
      // 使用更现代的字体栈
      fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2',
      adaptiveCSS: true,
      // 移动端自动换行支持
      linebreaks: {
        automatic: true,
        width: 'container'
      }
    },
    options: {
      ignoreHtmlClass: 'tex-ignore',
      processHtmlClass: 'tex-process',
      // 不显示菜单，保持简洁
      enableMenu: false
    },
    startup: {
      ready: () => {
        console.log('MathJax (Universal Markdown) ready');
        MathJax.startup.defaultReady();
        MathJax.startup.promise.then(() => {
          console.log('Math rendering completed');
        });
      }
    }
  };
</script>

<script defer src="https://unpkg.com/mermaid@11.1.1/dist/mermaid.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script"></script>

<!-- Site styles & favicon -->
<link rel="stylesheet" href="/assets/css/variables.css">
<link rel="stylesheet" href="/assets/css/utilities.css">
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="shortcut icon" href="/assets/favicon.ico">

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Initialize Mermaid
    if (window.mermaid && window.mermaid.initialize) {
      try { 
        window.mermaid.initialize(window.mermaidConfig || {}); 
        window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
      } catch (e) { 
        console.warn('Mermaid initialization failed:', e); 
      }
    }
    
    // MathJax will auto-initialize with the startup.ready config above
    // Listen for the mathjaxLoaded event for any post-processing
    document.addEventListener('mathjaxLoaded', () => {
      console.log('MathJax processing completed for page');
    });
  });

</script>
