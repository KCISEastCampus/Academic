<script>
  window.MathJax = {
    loader: {
      load: ['[tex]/mhchem']
    },
    startup: {
      ready: () => {
        MathJax.startup.defaultReady();
        MathJax.startup.promise.then(() => {
          document.dispatchEvent(new Event('mathjaxLoaded'));
        });
      }
    },
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      tags: 'ams',
      tagSide: 'right',
      packages: {'[+]': ['base', 'ams', 'mhchem']},
      processEscapes: true,
      processEnvironments: true,
      macros: {
        cosec: '\\operatorname{cosec}',
        arccos: '\\cos^{-1}',
        arcsin: '\\sin^{-1}',
        arctan: '\\tan^{-1}',
        arccot: '\\cot^{-1}',
        arcsec: '\\sec^{-1}',
        arccosec: '\\cosec^{-1}'
      }
    },
    chtml: {
      // Force MathJax to use proper math fonts for all content including \text{}
  matchFontHeight: false,
  scale: 1.0,
  mtextInheritFont: false,  // Prevent \text from inheriting page font
  fontURL: '/assets/vendor/mathjax/3.2.2/es5/output/chtml/fonts/woff-v2'
    },
    svg: {
      fontCache: 'global',
      mtextInheritFont: false
    },
    options: {
      enableMenu: false,
      ignoreHtmlClass: 'tex-ignore',
      processHtmlClass: 'tex-process'
    }
  };
</script>
<!-- Load MathJax (full bundle with mhchem included): local first with CDN fallbacks -->
<script>
  (function() {
    const sources = [
      '/assets/vendor/mathjax/3.2.2/es5/tex-chtml-full.js',
      'https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-chtml-full.js',
      'https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml-full.js'
    ];

    const script = document.createElement('script');
    script.id = 'MathJax-script';
    script.defer = true;
    script.crossOrigin = 'anonymous';

    let index = 0;
    const tryNext = () => {
      if (index >= sources.length) {
        console.error('MathJax failed to load from all sources');
        return;
      }
      const src = sources[index++];
  console.info('Loading MathJax from', src);
      script.src = src;
    };

    script.onload = () => {
      console.log('MathJax loaded from', script.src);
    };

    script.onerror = () => {
      console.warn('MathJax failed to load from', script.src);
      tryNext();
    };

    tryNext();
    document.head.appendChild(script);
  })();
</script>
